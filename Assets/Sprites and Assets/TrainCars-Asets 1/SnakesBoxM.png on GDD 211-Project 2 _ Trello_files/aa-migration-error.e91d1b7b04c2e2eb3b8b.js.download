(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{"./app/src/components/AtlassianAccountMigration/AtlassianAccountMigrationError.tsx":function(e,a,n){"use strict";n.r(a),n.d(a,"AtlassianAccountMigrationError",(function(){return D}));var i=n("./node_modules/react/index.js"),t=n.n(i),o=n("./packages/atlassian-analytics/index.ts"),l=n("./packages/config/index.ts"),r=n("./packages/i18n/index.ts"),s=n("./node_modules/@apollo/client/index.js");function c(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,i)}return n}function m(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?c(Object(n),!0).forEach((function(a){d(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function d(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}const u={context:{operationName:"ChangeEmail"}},g={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ChangeEmail"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"loginId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"email"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeMemberEmail"},arguments:[{kind:"Argument",name:{kind:"Name",value:"loginId"},value:{kind:"Variable",name:{kind:"Name",value:"loginId"}}},{kind:"Argument",name:{kind:"Name",value:"email"},value:{kind:"Variable",name:{kind:"Name",value:"email"}}},{kind:"Argument",name:{kind:"Name",value:"primary"},value:{kind:"BooleanValue",value:!0}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"email"}}]}}]}}]};var p=n("./app/src/components/EmailError/index.ts"),b=n("./app/src/components/ChangeEmailButton/index.ts"),E=n("./app/src/components/Wizard/index.ts"),k=n("./packages/nachos/button.ts"),f=n("./app/src/components/AtlassianAccountMigration/EmailMigrationDialog.tsx"),y=n("./app/src/components/AtlassianAccountMigration/fetchIllustration.ts"),h=n("./app/src/components/AtlassianAccountMigration/EmailMismatchErrorDialog.less"),v=n.n(h);const A={main:{full:n("./resources/images/aa-migration-wizard/illustration-error.svg"),mobile:n("./resources/images/aa-migration-wizard/illustration-error-mobile.svg")},email:{full:n("./resources/images/aa-migration-wizard/illustration-email.svg"),mobile:n("./resources/images/aa-migration-wizard/illustration-email-mobile.svg")}},M=Object(r.forNamespace)(["aa migration wizard","email mismatch error"],{shouldEscapeStrings:!1}),j=({accounts:e,onClickMigrate:a,onDismiss:n})=>{const[r,c]=Object(i.useState)();Object(i.useEffect)((()=>{Object(y.a)(A.main.full,v.a.illustration),Object(y.a)(A.main.mobile,v.a.illustration)})),Object(i.useEffect)((()=>{o.Analytics.sendScreenEvent({name:"aaMigrationWizardEmailMismatchScreen"})}),[]);const[d,h]=function(e){const a=m(m({},u),e);return s.useMutation(g,a)}(),[j,w]=Object(i.useState)(p.b.None),O=Object(i.useCallback)((e=>{e&&o.Analytics.sendScreenEvent({name:"atlassianAccountMigrationChangeEmailInlineDialog"})}),[]),_=Object(i.useCallback)((()=>{n(),o.Analytics.sendClosedComponentEvent({componentType:"overlay",componentName:"atlassianAccountMigrationOverlay",source:"aaMigrationWizardEmailMismatchScreen"})}),[n]);return r?t.a.createElement(f.a,{image:Object(y.a)(A.email.full,v.a.illustration),mobileImage:Object(y.a)(A.email.mobile,v.a.illustration),email:r,closeDialog:_}):t.a.createElement(E.a,{closeDialog:_,title:M("title",{email:e.trello.email}),image:Object(y.a)(A.main.full,v.a.illustration),mobileImage:Object(y.a)(A.main.mobile,v.a.illustration)},t.a.createElement("div",{className:v.a.content},t.a.createElement("div",{className:v.a.description},t.a.createElement("p",{className:v.a.mainMessage},M("main-message")),t.a.createElement("p",null,M("secondary-message")),t.a.createElement("ul",null,t.a.createElement("li",{key:"log-in-with-aa-email"},M("log-in-to-atlassian-with-email",{email:e.trello.email})),t.a.createElement("li",{key:"change-your-trello-email"},M("change-your-email-address-for-trello")),t.a.createElement("li",{key:"change-your-atlassian-email"},M("change-your-email-address-for-atlassian",{atlassianAccount:t.a.createElement("a",{key:"aa-change-email-link",href:l.identityBaseUrl+"/manage-profile/email",target:"_blank"},M("atlassian-account"))})))),t.a.createElement("div",{className:v.a.buttons},t.a.createElement(k.Button,{appearance:"primary",onClick:a},M("log-in-to-atlassian")),e.trello.loginId&&t.a.createElement(b.a,{emailError:j,onSubmitEmail:async a=>{w(p.b.None);try{if(!e.trello.loginId)throw Error("No login ID provided");await d({variables:{loginId:e.trello.loginId,email:a}}),c(a)}catch(e){const a=e.networkError?e.networkError.message:e.message,n=Object(p.c)(a);n?w(n):(console.error("Failed to change email",e),w(p.b.Unknown))}o.Analytics.sendClickedButtonEvent({buttonName:"atlassianAccountMigrationChangeEmailButton",source:"atlassianAccountMigrationChangeEmailInlineDialog"})},onTogglePopover:O,isSendingRequest:h.loading,emailPlaceholder:e.atlassian.email||""},M("change-trello-email")))))};var w=n("./app/src/components/AtlassianAccountMigration/AtlassianAccountMigrationErrorCodes.ts"),O=n("./packages/nachos/spinner.ts"),_=n("./app/src/components/AtlassianAccountMigration/AtlassianAccountMigrationClient.ts");const D=({code:e,onRetry:a,onDismiss:n})=>{const[l,r]=Object(i.useState)(),s=Object(i.useCallback)((()=>{n(),o.Analytics.sendClickedButtonEvent({buttonName:"atlassianAccountMigrationRetryButton",source:"atlassianAccountMigrationBanner"}),a()}),[n,a]);switch(Object(i.useEffect)((()=>{e===w.a.EMAIL_MISMATCH&&_.a.fetchAccountsInfo().then((e=>e&&r(e)),(e=>{console.error("Failed to fetch emails",{err:e}),r({atlassian:{email:null},trello:{email:null,loginId:null}})}))}),[e]),e){case w.a.EMAIL_MISMATCH:return l?t.a.createElement(j,{onClickMigrate:s,accounts:l,onDismiss:n}):t.a.createElement(O.a,null);default:throw new Error("Unhandled error code: ".concat(e))}};a.default=D},"./app/src/components/AtlassianAccountMigration/EmailMismatchErrorDialog.less":function(e,a,n){var i=n("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),t=n("./node_modules/css-loader/index.js?!./node_modules/postcss-loader/src/index.js?!./node_modules/less-loader/dist/cjs.js?!./app/src/components/AtlassianAccountMigration/EmailMismatchErrorDialog.less");"string"==typeof(t=t.__esModule?t.default:t)&&(t=[[e.i,t,""]]);var o={insert:"head",singleton:!1};i(t,o);e.exports=t.locals||{}},"./node_modules/css-loader/index.js?!./node_modules/postcss-loader/src/index.js?!./node_modules/less-loader/dist/cjs.js?!./app/src/components/AtlassianAccountMigration/EmailMismatchErrorDialog.less":function(e,a,n){(a=e.exports=n("./node_modules/css-loader/lib/css-base.js")(!1)).push([e.i,"._3Bd6HnKKkhFGD_{display:flex;flex:1;flex-direction:column;max-height:328px}._3Bd6HnKKkhFGD_ .G69uEb3MtDy4ET{display:flex;flex-direction:column;overflow-y:auto}._3Bd6HnKKkhFGD_ ._2zWt-TAgMI95Ed{margin-top:30px}._3Bd6HnKKkhFGD_ ._2zWt-TAgMI95Ed button{margin-right:8px}._2KecRqjUIETpLX{word-wrap:break-word}@media only screen and (max-width:1020px){._3AU-NEKdBS7j3e{width:100%;min-width:375px}}._3Bd6HnKKkhFGD_ .G69uEb3MtDy4ET ul{list-style:disc;padding-left:16px}._3Bd6HnKKkhFGD_ .G69uEb3MtDy4ET ul li{word-break:break-word;margin-bottom:8px}",""]),a.locals={content:"_3Bd6HnKKkhFGD_",description:"G69uEb3MtDy4ET",buttons:"_2zWt-TAgMI95Ed",breakable:"_2KecRqjUIETpLX",illustration:"_3AU-NEKdBS7j3e"}},"./resources/images/aa-migration-wizard/illustration-error-mobile.svg":function(e,a,n){e.exports=n.p+"images/aa-migration-wizard/illustration-error-mobile.62acfe93ab9237081fdf.svg"},"./resources/images/aa-migration-wizard/illustration-error.svg":function(e,a,n){e.exports=n.p+"images/aa-migration-wizard/illustration-error.f8c050e88d4cf8677340.svg"}}]);
//# sourceMappingURL=aa-migration-error.e91d1b7b04c2e2eb3b8b.js.map